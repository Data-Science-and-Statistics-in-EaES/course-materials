---
title: "Data classes"
subtitle: "<br><br> Data Science & Statistics"
author: "Gavin McNicol"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    self_contained: true
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r packages, echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(openintro)
library(DT)
library(scales)

my_theme <- theme(axis.text=element_text(size=24),
        axis.title=element_text(size=24,face="bold"))
```

class: middle

# Data classes

---

## Data classes

We talked about *types* so far, next we'll introduce the concept of *classes*

**Vectors** - we have covered

*   factors
*   dates
*   data frames
*   lists

--
- You can read more about classes and the underlying R logic [here](https://adv-r.hadley.nz/s3.html#s3-classes) if you're curious
  
---

## Factors

R uses factors to handle categorical variables.

Categorical variables have a fixed and known set of possible "levels" (integer values)

#### Example: Degree Type

```{r}
degrees <- factor(c("BS", "MS", "PhD", "MS"))
degrees
```

What is the data type of degrees? 

--

.pull-left[
```{r}
typeof(degrees)
```
]
.pull-right[
```{r}
class(degrees)
```
]


---

## More on factors

Factors **combine** character information with integers:

*   Character information becomes **level labels**
*   Integer information become the **level numbers** 

```{r}
glimpse(degrees)
as.integer(degrees)
```

**R will automatically assign categories to levels alphabetically, but we can over-ride that!**

---

## Dates

```{r}
y <- as.Date("2020-01-01") # typically YYYY-MM-DD format
y
```

What is the type of a date class object/variable?

--

```{r}
typeof(y)
class(y)
```

---

## More on dates

Dates in R are all relative to an "origin" which was January 1, 1970. 

Therefore all dates are treated like an integer (the number of days since the origin, 1 Jan 1970) and an integer (the origin) glued together

```{r}
as.integer(y)
as.integer(y) / 365 # roughly 50 yrs
```

---

## Data frames

Data frames are vectors of equal length glued together. We've already worked with data frames a lot!

```{r}
df <- starwars
head(df, 5)
```

What is the type of a data frame class object?

--

.pull-left[
```{r}
typeof(df)
```
]
.pull-right[
```{r}
class(df)
```
]

---

## Lists (and data frames)

Lists can combine multiple vectors of **any type and any length!**

```{r}
l <- list(
  x = 1:4,
  y = c("eaes", "494", "fall", "2021"),
  z = c(TRUE, FALSE)
)
l
```

--

- **In contrast:** A data frame is a **special list**, containing vectors of equal length

---

## Pull a vector from a data frame

- When we use the `pull()` function, we extract a vector from the data frame

```{r}
head(df, 3)

df %>%
  pull(name) #<<
```


---

class: middle

# Working with factors

---

```{r include=FALSE}
cat_lovers <- read_csv("data/cat-lovers.csv")
```

## Read data in as character strings

```{r}
glimpse(cat_lovers)
```

---

## But coerce when plotting

```{r out.width="30%"}
ggplot(cat_lovers, mapping = aes(x = handedness)) +
  geom_bar() +
  my_theme
```

---

## Use forcats to manipulate factors

The `{forcats}` package gives us functions **"for categorical data"** 

```{r out.width="30%"}
cat_lovers %>%
  mutate(handedness = fct_infreq(handedness)) %>% #<<
  ggplot(mapping = aes(x = handedness)) +
  geom_bar() + my_theme
```

--

What does the `fct_infreq()` function do?

---

## Come for the functionality

.pull-left[
... stay for the logo
]
.pull-right[
```{r echo=FALSE, out.width="70%"}
knitr::include_graphics("img/forcats-part-of-tidyverse.png")
```
]

.pull-left-wide[
- Factors are useful when you want to override the alphabetical ordering of character vectors (for example during plotting)
- They are also useful in modeling scenarios
- The **forcats** package provides a suite of useful tools that solve common problems with factors
]

---

class: middle

# Working with dates

---

## Make a date

.pull-left[
```{r echo=FALSE, out.width="65%", fig.align="center"}
knitr::include_graphics("img/lubridate-not-part-of-tidyverse.png")
```
]
.pull-right[
- **lubridate** is the tidyverse-friendly package for dates
- It's not a *core* tidyverse package!
- Install with `install.packages("tidyverse)` BUT: you need to use `library(lubridate)` to load it separately!
]

---

class: middle

### we're just going to scratch the surface of working with dates in R here...

---

## Step 1a. Look at date related columns

Notice we don't have a single date variable. It's spread aross `year`, `month` and `day`. How do you map three variables to an x-axis?

```{r message = FALSE, warning = FALSE}
glimpse(earthquakes)
```

---

## Step 1b. Construct dates

Let's try just glueing together a full date as a character string (factor).

.midi[
```{r output.lines=7, echo = FALSE, message = FALSE}
library(glue)

earthquakes %>%
  mutate(
    date = glue("{year} {month} {day}") #<<
    ) %>% 
  relocate(date)
```
]

---

## Step 2. Count based on date 

.midi[
```{r}
earthquakes %>%
  mutate(date = glue("{year} {month} {day}")) %>%
  count(date) %>% #<<
  arrange(desc(n)) #<<
```
]

---

## Step 3. Visualise bookings over time, using date on x-axis

.midi[
```{r out.width="80%", fig.asp = 0.4}
earthquakes %>%
  mutate(date = glue("{year} {month} {day}")) %>%
  ggplot(aes(x = date, y = richter)) + #<<
  geom_point() + #<<
  my_theme
```
]

---

.hand[zooming in a bit...]

.question[
What is weird here?
]

```{r out.width="80%", echo=FALSE, fig.asp = 0.5}
earthquakes %>%
  mutate(date = glue("{year} {month} {day}")) %>%
  slice(20:35) %>% 
  ggplot(aes(x = date, y = richter)) +
  geom_point() +
  my_theme +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```

---

## Step 1. *REVISED* Construct dates **"as dates"**

.midi[
```{r message = FALSE}
library(lubridate)

earthquakes %>%
  mutate(
    date = ymd(glue("{year} {month} {day}")) #<< # wrap in ymd() function!
    ) %>% 
  relocate(date) #<<
```
]

---

## Step 2. Count based on date 

.midi[
```{r}
earthquakes %>%
  mutate(date = ymd(glue("{year} {month} {day}"))) %>% 
  count(date) %>% #<<
  arrange(desc(n)) #<<
```
]

---

## Step 3a. Visualise earthquakes by date

.midi[
```{r out.width="80%", fig.asp = 0.4}
earthquakes %>%
  mutate(date = ymd(glue("{year} {month} {day}"))) %>%
  ggplot(aes(x = date, y = richter)) + #<<
  geom_point() + #<<
  my_theme 
```
]

---

.hand[zooming in a bit...]

.question[
Did if fix the problem if we zoom in?
]

.midi[
```{r out.width="80%", echo=FALSE, fig.asp = 0.4}
earthquakes %>%
  mutate(date = ymd(glue("{year} {month} {day}"))) %>%
  filter(year == 1933) %>% #<<
  ggplot(aes(x = date, y = richter)) + #<<
  geom_point() +
  my_theme 
```
]


---

.center[
.large[
This class content was built from the Data Science in a Box source materials.
https://datasciencebox.org/index.html
]
]

