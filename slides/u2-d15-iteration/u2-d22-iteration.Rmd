---
title: "Iteration"
subtitle: "<br><br> Data Science & Statistics"
author: "Gavin McNicol"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    self_contained: true
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r packages, echo = FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
```

class: middle

# Iteration

---

## Reviewing our Data


```{r}
# Chicago temperatures in Fahrenheit in 3 neighborhoods in January
temperatures <- tibble::tibble(
  glenview = c(32, 35, 34, 38, NA, 20),
  loop = c(34, 38, 40, 40, 43, 27),
  pilsen = c(33, 36, NA, 40, 39, 23)
)

head(temperatures, 3)
```

---

## Reviewing our Function

```{r}
convert_temperature <- function(temperature_vector){
  
  celcius <- (temperature_vector - 32) * (5/9) 
  kelvin <- celcius + 273.15 
    
  tibble("fahrenheit" = temperature_vector,
         "celcius" = celcius,
         "kelvin" = kelvin) 
  
}
```

--

```{r}
convert_temperature(temperatures$glenview) %>%  head(3)
```

--

**What if we wanted to convert temperatures from all neighborhoods at once?**

---

## Define the task

**Goal: Convert temperatures for three (or more) different neighborhoods**
 
We need to...

* Run the `convert_temperature()` function on all the columns of data

```{r eval=FALSE}
convert_temperature(temperatures[1]) # temperatures$glenview
convert_temperature(temperatures[2]) # temperatures$loop
convert_temperature(temperatures[3]) # temperatures$pilsen
```

* Combine the resulting data frames from each run into one data frame

---

## Iteration

.question[
How can we tell R to apply the `convert_temperature()` function to each column in `temperatures`?
]

--

- Option 1: Write a **for loop**, i.e. explicitly tell R to select a column (1,2,3, etc.), apply the function, store the result, then select the next column, apply the function, append the result to the stored result from the previous column, and so on and so forth.

--

- Option 2: **Map** the function to each element in the list of links, and let R take care of the storing and appending of results.
--



We'll go with Option 2! 
  
**(Though, loops are covered in DataCamp and are useful to know!)**

---

## How does mapping work?

We can use map functions if we change our data object class to a **list**!

```{r}
temperatures_list <- list( #<<
  glenview <- c(32, 35, 34, 38, NA, 20),
  loop <- c(34, 38, 40, 40, 43, 27),
  pilsen <- c(33, 36, NA, 40, 39, 23)
)
```
--
```{r}
temperatures_list
```
--
```{r}
temperatures_list[[1]]
```

---

## How does mapping work?

We can use map functions if we change our data object class to a **list**!

```{r}
temperatures_list <- list( #<<
  glenview <- c(32, 35, 34, 38, NA, 20),
  loop <- c(34, 38, 40, 40, 43, 27),
  pilsen <- c(33, 36, NA, 40, 39, 23)
)
```

**...then use the `map()` function from the tidyverse `{purrr}` package!**

```{r}
map(temperatures_list, mean)
```

---

## How does mapping work?

We can use map functions if we change our data object class to a **list**!

```{r}
temperatures_list <- list( #<<
  glenview <- c(32, 35, 34, 38, NA, 20),
  loop <- c(34, 38, 40, 40, 43, 27),
  pilsen <- c(33, 36, NA, 40, 39, 23)
)
```

--
**...but without NAs!**

```{r}
map(temperatures_list, mean, na.rm = T)
```

---

## How does mapping work?

We can use map functions if we change our data object class to a **list**!

```{r}
temperatures_list <- list( #<<
  glenview <- c(32, 35, 34, 38, NA, 20),
  loop <- c(34, 38, 40, 40, 43, 27),
  pilsen <- c(33, 36, NA, 40, 39, 23)
)
```

--
**...and convert to a data frame**

```{r}
map_dfc(temperatures_list, mean, na.rm = T)
```

---

## How does mapping work?

We can use map functions if we change our data object class to a **list**!

```{r}
temperatures_list <- list( #<<
  glenview <- c(32, 35, 34, 38, NA, 20),
  loop <- c(34, 38, 40, 40, 43, 27),
  pilsen <- c(33, 36, NA, 40, 39, 23)
)
```

--
**...and convert to chr. strings**

```{r}
map_chr(temperatures_list, mean, na.rm = T)
```

---

## `map_something`

Functions for looping over an object and returning a value (of a specific type):

* `map()` - returns a list
* `map_lgl()` - returns a logical vector
* `map_int()` - returns a integer vector
* `map_dbl()` - returns a double vector
* `map_chr()` - returns a character vector
* `map_df()` / `map_dfr()` - returns a data frame by row binding
* `map_dfc()` - returns a data frame by column binding
* ...
* `?map` for help

---

## Let's try iterating over columns of temperature data

```{r}
map(temperatures_list, convert_temperature) 
```

---

## And create a pipeline!

```{r}
map(temperatures_list, head, 3) %>% 
map(convert_temperature) 
```

---

class: middle

# Questions?


---

.your-turn[
### .hand[Your turn!]
.midi[
- Clone `unit-6-YOUR_LAST_NAME` into RStudio
- Finish `lab 06 - writing functions`
- Or start `hw 06 - iterating functions`
]
]

---

.center[
.large[
This class content was built from the Data Science in a Box source materials.
https://datasciencebox.org/index.html
]
]
