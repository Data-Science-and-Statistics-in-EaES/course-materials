---
title: "Functions"
subtitle: "<br><br> Data Science & Statistics"
author: "Gavin McNicol"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    self_contained: true
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r packages, echo = FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(rvest)
library(DT)
```

class: middle

# Functions

---

## Why are functions powerful?

---

## Why are functions powerful?

```{r}
# Chicago temperatures in Fahrenheit in 3 neighborhoods in January
temperatures <- tibble::tibble(
  glenview = c(32, 35, 34, 38, NA, 20),
  loop = c(34, 38, 40, 40, 43, 27),
  pilsen = c(33, 36, NA, 40, 39, 23),
)

head(temperatures, 3)
```

--

.pull-left[
**Is this an example of tidy data?**
]

---

## Why are functions powerful?

```{r}
# pivot longer
temperatures %>% 
  pivot_longer(names_to = "neighborhood",  #<<
               values_to = "fahrenheit", #<<
               cols = 1:3) %>%  #<<
  head(5)
```

--

.pull-left[
**Now it's tidy!**
]

---

## Why are functions powerful?

```{r}
# pivot longer
temperatures %>% 
  pivot_longer(names_to = "neighborhood", 
               values_to = "fahrenheit",
               cols = 1:3) %>% 
  mutate(celcius = (fahrenheit - 32) * (5/9)) %>%  #<<
  head(5)
```

--

**And we can use functions like mutate to create entire columns!**

---

## Why are functions powerful?

**How would we convert Fahrenheit to Celcius "manually"?**

```{r}
# no tidying up
head(temperatures, 5)
```

---

## Why are functions powerful?

**How would we convert Fahrenheit to Celcius "manually"?**

```{r}
# convert the temperatures from fahrenheit to celcius
temperatures$glenview <- (temperatures$glenview - 32) * (5/9) #<<
temperatures$loop <- (temperatures$loop - 32) * (5/9) #<<
temperatures$pilsen <- (temperatures$glenview - 32) * (5/9) #<<

head(temperatures, 5)
```

--

**Why is this not optimal?**

---

## Function benefits!

- Automate common tasks in a more powerful and general way than copy-and-pasting:
  - Shorter coder
  - Fewer changes when inputs change
  - Fewer mistakes

--

Down the line: Improve your reach as a data scientist by writing functions (and packages!) that others use

```{r echo=FALSE, out.width="30%"}
knitr::include_graphics("img/cat-coding.gif")
```

---

## When should YOU write a function?

**Rule of thumb:** When youâ€™ve copied and pasted a block of code more than twice.

```{r}
temperatures$glenview <- (temperatures$glenview - 32) * (5/9)
temperatures$loop <- (temperatures$loop - 32) * (5/9)
temperatures$pilsen <- (temperatures$glenview - 32) * (5/9)
```

---

## Turn your code into a function

Answer three questions:   
  
  1. What do you want the function to do?
  2. What inputs will the function need?
  3. What do you want to call the function?
  
Then write the function using function syntax!

---

## Turn your code into a function

(1) What do you want the function to do?

```{r}
temperatures$glenview <- (temperatures$glenview - 32) * (5/9)
temperatures$loop <- (temperatures$loop - 32) * (5/9)
temperatures$pilsen <- (temperatures$glenview - 32) * (5/9)
```

**What is each column in a data frame?**

--

We want to take a **vector** (column) of temperature values in Fahrenheit and convert them to Celcius.

--

```{r eval = F}
# generic form
(temperature_vector - 32) * (5/9) #<<
```

---

## Turn your code into a function

(2) What inputs will the function need?

```{r eval = F}
(temperature_vector - 32) * (5/9) 
```

--

```{r eval = F}
# a vector of temperatures in Fahrenheit
temperature_vector #<< 
```

---

## Turn your code into a function

(3) What do we want to call our function?  

---

## Naming functions

"NASA is great at naming things" - Jed Bartlet (POTUS circa 1999.)


```{r echo=FALSE, out.width="75%"}
knitr::include_graphics("img/nasa-names.jpeg")
```

---

## Tidyverse guidance for naming

- Names should be short but clearly evoke what the function does

--
- Names should be verbs, not nouns

--
- Multi-word names should be separated by underscores (`snake_case` as opposed to `camelCase`)

--
- A family of functions should be named similarly (`convert_temperature()`, `convert_pressure()` OR `fct_reorder()`, `fct_relevel()` etc.)

--
- Avoid overwriting existing (especially widely used) functions

```{r eval=FALSE}
# JUST DON'T
mean <- function(x){ 
  x * 3 
  }
```

---

## Turn your code into a function

(3) What do we want to call our function? 

```{r eval = F}
(temperature_vector - 32) * (5/9) 
```

--

```{r eval = F}
convert_temperature #<<
```

---

## Turn your code into a function

Answer three questions:
  (1) What do you want the function to do?
```{r eval = F}
(temperature_vector - 32) * (5/9) 
```

  (2) What inputs will the function need?
```{r eval = F}
temperature_vector 
```
  
  (3) What do you want to call the function?
```{r eval = F}
convert_temperature 
```

.pull-left[
**Now we can write the function!**
]

---

## 3 steps to write the function

(1) Write the code for what you want the function to do

```{r eval=FALSE}
# function code
```

--

```{r eval=FALSE}
(temperature_vector - 32) * (5/9) 
```

---

## 3 steps to write the function

(2) Wrap it in the function expression and add the arguments

```{r eval=FALSE}
function(){                          # << first line 
                                     # << space
(temperature_vector - 32) * (5/9) 
                                     # << space
}                                    # << last line 
```

--

Add arguments for function

```{r eval=FALSE}
function(temperature_vector){        #<<
  
(temperature_vector - 32) * (5/9) 
  
}
```

---

## 3 steps to write the function

(3) Assign the function to a good function name

```{r eval=FALSE}
function(temperature_vector){
  
(temperature_vector - 32) * (5/9) 
  
}
```

--

```{r}
convert_temperature <- function(temperature_vector){   #<<
  
  (temperature_vector - 32) * (5/9)
  
}
```

---

## test it out!

--

```{r}
convert_temperature(32)
```

--

```{r}
convert_temperature(100)
```

--

```{r echo = F}
temperatures <- tibble::tibble(
  glenview = c(32, 35, 34, 38, NA, 20),
  loop = c(34, 38, 40, 40, 43, 27),
  pilsen = c(33, 36, NA, 40, 39, 23),
)
```


```{r}
# remember: temperatures$glenview is just a vector of temperatures
convert_temperature(temperatures$glenview)
```

---

class: middle

# Few more notes on Functions

---

## Function Extras

.pull-left-wide[
- They take input(s) defined in the function definition

```{r eval=FALSE}
function([inputs separated by commas]){
  # what to do with those inputs
}
```

- By default they return the last value computed in the function

```{r eval=FALSE}
scrape_page <- function(x){
  # do bunch of stuff with the input...
  
  # return a tibble
  tibble(...)
}
```

]

---

.question[
How could we improve the output even more?
]

```{r}
convert_temperature <- function(temperature_vector){
  
  celcius <- (temperature_vector - 32) * (5/9)  #<<
  kelvin <- celcius + 273.15 #<<
    
  tibble("fahrenheit" = temperature_vector, #<<
         "celcius" = celcius, #<<
         "kelvin" = kelvin) #<<
  
}
```

--

```{r}
convert_temperature(temperatures$glenview)
```

---

class: middle

# Questions?


---

.your-turn[
### .hand[Your turn!]
.midi[
- Clone `unit-6-YOUR_LAST_NAME` into RStudio
- Start `lab 06 - writing functions`
- Complete exercises 1-5
]
]

---

.center[
.large[
This class content was built from the Data Science in a Box source materials.
https://datasciencebox.org/index.html
]
]
