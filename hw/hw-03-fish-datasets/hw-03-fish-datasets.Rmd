---
title: "HW 03 - Great Lakes Fish Datasets"
output: 
  tufte::tufte_html:
    css: ../hw.css
    tufte_variant: "envisioned"
    highlight: pygments
link-citations: yes
---

```{r include = FALSE}
knitr::opts_chunk$set(
  eval = FALSE,
  out.width = "80%",
  fig.asp = 0.618,
  fig.width = 10,
  dpi = 300
)
```

```{r photo, fig.margin = TRUE, echo = FALSE, fig.width = 3, fig.cap = "Photo from Great Lakes Fishing Database", eval = TRUE}
knitr::include_graphics("img/stocking.jpg")
```

For Homework-03 you'll continue using the [Great Lakes Database](http://www.glfc.org/great-lakes-databases.php) and [Great Lakes Fish Stocking database](http://www.glfc.org/fishstocking/index.htm).

These databases are updated, maintained, and hosted by the U.S.
Fish and Wildlife Service.

# Learning goals

-   More practice data wrangling and data visualization
-   Practice using join functions to merge dataframes
-   Practice using pivot functions to make dataframes longer or wider

# Getting started

If you're looking at these instructions you've already done the following steps, but as a reminder:

-   Go to the course GitHub organization and locate your Unit 3 repo, which should be named `unit-3-YOUR_LAST_NAME`.
-   Grab the URL of the repo, and clone it in RStudio.
-   First, open the R Markdown instructions `hw-O3-fish-stocking.Rmd` and the lab starter `hw-03.Rmd` and Knit them
-   Make sure they compile without errors.

## Warm up

Before we introduce the data, let's warm up with some simple exercises.

-   Update the YAML, changing the author name to your name, and **knit** the document.
-   Commit your changes with a meaningful commit message.
-   Push your changes to GitHub.
-   Go to your repo on GitHub and confirm that your changes are visible in your Rmd **and** md files. If anything is missing, commit and push again.

## Packages

We'll use the **tidyverse** package for much of the data wrangling {dplyr} and visualisation {ggplot2} functions.
You can load them by running the following in your Console or running the code chunk from within the .Rmd file:

```{r load-packages, message = FALSE, eval = TRUE}
library(tidyverse)
```

## Data

Load the datasets on Great Lakes Fish Catches *and* Fish Stocking Events using the following code chunks:

```{r load-data, message = FALSE}
catch_data <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-06-08/fishing.csv')

fish_stock <- read_csv("data/great-lakes-fish-stock.csv")
```

# Look at the data

Let's Look at both datasets to remind ourselves what they contain.

First, look at `catch_data` with the following code chunk:

```{r glimpse-catch}
glimpse(catch_data)
```

Next, look at `fish_stock` with the following code chunk:

```{r glimpse-catch}
glimpse(fish_stock)
```

If you need a refresher on what each variable is, look at the data dictionary at the bottom of this homework document.

# Exercises

In the first set of exercises, we want to wrangle the two data frames to prepare to merge them.
The merged data table we want to end with will have a yearly total catch and stocking weight (in the same units (lbs)) for each lake.

1.  First, let's simplify our task by deciding what columns we want to retain from each dataset. Use `select()` to pick out `year`, `lake`, `species`, and `grand_total` from `catch_data` and to pick out `YEAR`, `MONTH`, `LAKE`, `STATE_PROV`, `SPECIES`, and `WEIGHT` from `fish_stock`. Copy both empty code chunks below into the space for Exercise 1 in your hw-03.Rmd starter file, and complete it as indicated above. To save your output, use the assign operator (`<-`) to overwrite the original dataframe objects.

```{r catch-data-subset}
# add your code here
```

```{r fish-stock-subset}
# add your code here
```

2.  Use `glimpse()` to look at your new datasets. To do this, create a new code chunk under Exercise 2 in your starter file.

There are some differences between the two datasets that we need to address using some wrangling functions before we can merge these two data tables.

Here's a at least three things we can see:

`catch_data` - Each row is a **yearly total** - The variables are all **lower case** - The lake names are spelled out (e.g., "Michigan")

`fish_stock` - Each row is a **year-month** combination (during which fish stocking occurred) - The variable names are all **upper case** - The lake names are abbreviated (e.g., "MU")

1.  How many observations (rows) does the dataset have?
    Instead of hard coding the number in your answer, use inline code.

2.  Run `View(accidents)` in your Console to view the data in the data viewer.
    What does each row in the dataset represent?

üß∂ ‚úÖ ‚¨ÜÔ∏è Knit, *commit, and push your changes to GitHub with an appropriate commit message. Make sure to commit and push all changed files so that your Git pane is cleared up afterwards.*

3.  Recreate the following plot, and describe in context of the data. In your answer, don't forget to label your R chunk as well (where it says `label-me-1`). Your label should be short, informative, shouldn't include spaces, and shouldn't shouldn't repeat a previous label.

```{r eval = TRUE, echo = FALSE, fig.fullwidth = TRUE}
accidents %>%
  mutate(day_of_week_type = if_else(day_of_week %in% c("Saturday", "Sunday"), "Weekend", "Weekday")) %>%
  ggplot(aes(x = time, fill = severity)) +
  geom_density(alpha = 0.5) +
  facet_wrap(~day_of_week_type, ncol = 1) +
  theme_minimal() +
  scale_fill_viridis_d() +
  labs(
    title = "Number of accidents throughout the day",
    subtitle = "By day of week and severity",
    x = "Time of day",
    y = "Density",
    fill = "Severity"
  )
```

üß∂ ‚úÖ ‚¨ÜÔ∏è Knit, *commit, and push your changes to GitHub with an appropriate commit message. Make sure to commit and push all changed files so that your Git pane is cleared up afterwards.*

4.  Create another data visualisation based on these data and interpret it. You can choose any variables and any type of visualisation you like, but it must have at least three variables, e.g. a scatterplot of x vs. y isn't enough, but if points are coloured by z, that's fine. In your answer, don't forget to label your R chunk as well (where it says `label-me-2`).

üß∂ ‚úÖ ‚¨ÜÔ∏è Knit, *commit, and push your changes to GitHub with an appropriate commit message. Make sure to commit and push all changed files so that your Git pane is cleared up afterwards and review the md document on GitHub to make sure you're happy with the final state of your work.*

## Data dictionary

Below is the full data dictionary.

### fishing.csv (`catch_data`)

| variable    | class     | description                                                         |
|:------------|:----------|:--------------------------------------------------------------------|
| year        | double    | Year of measurement                                                 |
| lake        | character | Lake Name                                                           |
| species     | character | Species of fish                                                     |
| grand_total | double    | Grand total of observed                                             |
| comments    | character | Comments from the dataset providers                                 |
| region      | character | Region of the US/Canada, note there is some inconsistency           |
| values      | double    | Production amounts have been rounded to the nearest thousand pounds |

### great-lakes-fish-stock.csv (`fish_stock`)

-   `YEAR`: year of stocking, YYYY
-   `MONTH`: month of stocking, not always provided by agency
-   `LAKE`: Great Lake, coded
-   **ER (Lake Erie); HU (Huron); MI (Lake Michigan); ON (Lake Ontario); SC (Lake St. Clare); SU (Lake Superior)**
-   `STATE_PROV`: state or province where stocking occurred, coded
-   **IL (Illinois); IN (Indiana); MI (Michigan); MN (Minnesota); NY (New York); OH (Ohio); ON (Ontario); PA (Pennsylvania); WI (Wisconsin)**
-   `SPECIES`: species coded by naming convention
-   `NO_STOCKED`: number of fish stocked
-   `AGEMONTH`: age in months, not always provided by agency
-   `WEIGHT`: total weight of fish stocked in kilograms
